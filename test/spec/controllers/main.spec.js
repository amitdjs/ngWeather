'use strict';

describe('Controller: MainCtrl', function () {

  // load the controller's module
  beforeEach(module('prudentialApp'));

  var MainCtrl,
    _RestCallFactoryMock_ = {get: function (){}},
  mockedResult = {"cod":"200","message":0.0081,"cnt":38,"list":[{"dt":1521093600,"main":{"temp":7.45,"temp_min":7.45,"temp_max":8.21,"pressure":994.16,"sea_level":1001.67,"grnd_level":994.16,"humidity":87,"temp_kf":-0.76},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":92},"wind":{"speed":5.56,"deg":126.508},"rain":{"3h":1.07},"sys":{"pod":"n"},"dt_txt":"2018-03-15 06:00:00"},{"dt":1521104400,"main":{"temp":7.89,"temp_min":7.89,"temp_max":8.46,"pressure":993.83,"sea_level":1001.41,"grnd_level":993.83,"humidity":97,"temp_kf":-0.57},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":92},"wind":{"speed":4.65,"deg":135.005},"rain":{"3h":2.625},"sys":{"pod":"d"},"dt_txt":"2018-03-15 09:00:00"},{"dt":1521115200,"main":{"temp":9.6,"temp_min":9.6,"temp_max":9.98,"pressure":994.77,"sea_level":1002.21,"grnd_level":994.77,"humidity":100,"temp_kf":-0.38},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":92},"wind":{"speed":2.52,"deg":162.001},"rain":{"3h":1.865},"sys":{"pod":"d"},"dt_txt":"2018-03-15 12:00:00"},{"dt":1521126000,"main":{"temp":10.6,"temp_min":10.6,"temp_max":10.79,"pressure":995.75,"sea_level":1003.18,"grnd_level":995.75,"humidity":99,"temp_kf":-0.19},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":56},"wind":{"speed":2.97,"deg":199.001},"rain":{"3h":0.17},"sys":{"pod":"d"},"dt_txt":"2018-03-15 15:00:00"},{"dt":1521136800,"main":{"temp":9.27,"temp_min":9.27,"temp_max":9.27,"pressure":997.63,"sea_level":1005.1,"grnd_level":997.63,"humidity":95,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":48},"wind":{"speed":2.91,"deg":178.503},"rain":{"3h":0.02},"sys":{"pod":"d"},"dt_txt":"2018-03-15 18:00:00"},{"dt":1521147600,"main":{"temp":7.19,"temp_min":7.19,"temp_max":7.19,"pressure":999.73,"sea_level":1007.18,"grnd_level":999.73,"humidity":94,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":8},"wind":{"speed":2.36,"deg":152.503},"rain":{"3h":0.0099999999999998},"sys":{"pod":"n"},"dt_txt":"2018-03-15 21:00:00"},{"dt":1521158400,"main":{"temp":6.18,"temp_min":6.18,"temp_max":6.18,"pressure":1000.8,"sea_level":1008.37,"grnd_level":1000.8,"humidity":99,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":68},"wind":{"speed":2.37,"deg":149.011},"rain":{"3h":0.095000000000001},"sys":{"pod":"n"},"dt_txt":"2018-03-16 00:00:00"},{"dt":1521169200,"main":{"temp":6.62,"temp_min":6.62,"temp_max":6.62,"pressure":1001.81,"sea_level":1009.36,"grnd_level":1001.81,"humidity":98,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":88},"wind":{"speed":1.49,"deg":136.002},"rain":{"3h":0.265},"sys":{"pod":"n"},"dt_txt":"2018-03-16 03:00:00"},{"dt":1521180000,"main":{"temp":7.1,"temp_min":7.1,"temp_max":7.1,"pressure":1003.11,"sea_level":1010.59,"grnd_level":1003.11,"humidity":98,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":88},"wind":{"speed":1.26,"deg":147.501},"rain":{"3h":0.13},"sys":{"pod":"n"},"dt_txt":"2018-03-16 06:00:00"},{"dt":1521190800,"main":{"temp":8.39,"temp_min":8.39,"temp_max":8.39,"pressure":1004.65,"sea_level":1012.25,"grnd_level":1004.65,"humidity":100,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":92},"wind":{"speed":1.73,"deg":134.006},"rain":{"3h":0.275},"sys":{"pod":"d"},"dt_txt":"2018-03-16 09:00:00"},{"dt":1521201600,"main":{"temp":9.79,"temp_min":9.79,"temp_max":9.79,"pressure":1006.16,"sea_level":1013.69,"grnd_level":1006.16,"humidity":100,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":92},"wind":{"speed":1.79,"deg":115.001},"rain":{"3h":0.125},"sys":{"pod":"d"},"dt_txt":"2018-03-16 12:00:00"},{"dt":1521212400,"main":{"temp":10.61,"temp_min":10.61,"temp_max":10.61,"pressure":1006.81,"sea_level":1014.42,"grnd_level":1006.81,"humidity":98,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":92},"wind":{"speed":2.23,"deg":96.0053},"rain":{"3h":0.05},"sys":{"pod":"d"},"dt_txt":"2018-03-16 15:00:00"},{"dt":1521223200,"main":{"temp":8.6,"temp_min":8.6,"temp_max":8.6,"pressure":1008.43,"sea_level":1016.07,"grnd_level":1008.43,"humidity":95,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":92},"wind":{"speed":3.99,"deg":80.0018},"rain":{"3h":0.135},"sys":{"pod":"d"},"dt_txt":"2018-03-16 18:00:00"},{"dt":1521234000,"main":{"temp":6.27,"temp_min":6.27,"temp_max":6.27,"pressure":1010.6,"sea_level":1018.15,"grnd_level":1010.6,"humidity":95,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":56},"wind":{"speed":3.81,"deg":70.5005},"rain":{"3h":0.14},"sys":{"pod":"n"},"dt_txt":"2018-03-16 21:00:00"},{"dt":1521244800,"main":{"temp":5.86,"temp_min":5.86,"temp_max":5.86,"pressure":1011.91,"sea_level":1019.58,"grnd_level":1011.91,"humidity":96,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":88},"wind":{"speed":4.71,"deg":64.001},"rain":{"3h":0.18},"sys":{"pod":"n"},"dt_txt":"2018-03-17 00:00:00"},{"dt":1521255600,"main":{"temp":4.69,"temp_min":4.69,"temp_max":4.69,"pressure":1013.2,"sea_level":1020.91,"grnd_level":1013.2,"humidity":98,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":92},"wind":{"speed":6.66,"deg":72.5104},"rain":{"3h":0.44},"sys":{"pod":"n"},"dt_txt":"2018-03-17 03:00:00"},{"dt":1521266400,"main":{"temp":2.62,"temp_min":2.62,"temp_max":2.62,"pressure":1015.33,"sea_level":1023.13,"grnd_level":1015.33,"humidity":97,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10n"}],"clouds":{"all":88},"wind":{"speed":8.06,"deg":73.0023},"rain":{"3h":0.54},"sys":{"pod":"n"},"dt_txt":"2018-03-17 06:00:00"},{"dt":1521277200,"main":{"temp":1.04,"temp_min":1.04,"temp_max":1.04,"pressure":1018.32,"sea_level":1026.17,"grnd_level":1018.32,"humidity":91,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":80},"wind":{"speed":8.97,"deg":71.5034},"rain":{"3h":0.09},"snow":{"3h":0.215},"sys":{"pod":"d"},"dt_txt":"2018-03-17 09:00:00"},{"dt":1521288000,"main":{"temp":1.24,"temp_min":1.24,"temp_max":1.24,"pressure":1020.8,"sea_level":1028.65,"grnd_level":1020.8,"humidity":78,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":8},"wind":{"speed":10.06,"deg":72.0004},"rain":{},"snow":{"3h":0.01},"sys":{"pod":"d"},"dt_txt":"2018-03-17 12:00:00"},{"dt":1521298800,"main":{"temp":0.99,"temp_min":0.99,"temp_max":0.99,"pressure":1022.01,"sea_level":1029.9,"grnd_level":1022.01,"humidity":70,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"02d"}],"clouds":{"all":8},"wind":{"speed":10.43,"deg":71.0002},"rain":{},"snow":{},"sys":{"pod":"d"},"dt_txt":"2018-03-17 15:00:00"},{"dt":1521309600,"main":{"temp":-0.1,"temp_min":-0.1,"temp_max":-0.1,"pressure":1023.53,"sea_level":1031.39,"grnd_level":1023.53,"humidity":62,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":76},"wind":{"speed":9.27,"deg":62.502},"rain":{},"snow":{},"sys":{"pod":"d"},"dt_txt":"2018-03-17 18:00:00"},{"dt":1521320400,"main":{"temp":-0.26,"temp_min":-0.26,"temp_max":-0.26,"pressure":1024.83,"sea_level":1032.8,"grnd_level":1024.83,"humidity":63,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13n"}],"clouds":{"all":68},"wind":{"speed":8.06,"deg":58.0042},"rain":{},"snow":{"3h":0.04},"sys":{"pod":"n"},"dt_txt":"2018-03-17 21:00:00"},{"dt":1521331200,"main":{"temp":-0.67,"temp_min":-0.67,"temp_max":-0.67,"pressure":1025.43,"sea_level":1033.36,"grnd_level":1025.43,"humidity":65,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13n"}],"clouds":{"all":64},"wind":{"speed":8.16,"deg":56.002},"rain":{},"snow":{"3h":0.095},"sys":{"pod":"n"},"dt_txt":"2018-03-18 00:00:00"},{"dt":1521342000,"main":{"temp":-1.42,"temp_min":-1.42,"temp_max":-1.42,"pressure":1025.21,"sea_level":1033.21,"grnd_level":1025.21,"humidity":66,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13n"}],"clouds":{"all":64},"wind":{"speed":8.53,"deg":54.5013},"rain":{},"snow":{"3h":0.14},"sys":{"pod":"n"},"dt_txt":"2018-03-18 03:00:00"},{"dt":1521352800,"main":{"temp":-1.86,"temp_min":-1.86,"temp_max":-1.86,"pressure":1025.41,"sea_level":1033.4,"grnd_level":1025.41,"humidity":65,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13n"}],"clouds":{"all":68},"wind":{"speed":8.85,"deg":55.0005},"rain":{},"snow":{"3h":0.21},"sys":{"pod":"n"},"dt_txt":"2018-03-18 06:00:00"},{"dt":1521363600,"main":{"temp":-1.11,"temp_min":-1.11,"temp_max":-1.11,"pressure":1026.1,"sea_level":1034.06,"grnd_level":1026.1,"humidity":64,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13d"}],"clouds":{"all":88},"wind":{"speed":9.26,"deg":58},"rain":{},"snow":{"3h":0.235},"sys":{"pod":"d"},"dt_txt":"2018-03-18 09:00:00"},{"dt":1521374400,"main":{"temp":0.07,"temp_min":0.07,"temp_max":0.07,"pressure":1026.59,"sea_level":1034.54,"grnd_level":1026.59,"humidity":64,"temp_kf":0},"weather":[{"id":600,"main":"Snow","description":"light snow","icon":"13d"}],"clouds":{"all":76},"wind":{"speed":9.41,"deg":60.5025},"rain":{},"snow":{"3h":0.045},"sys":{"pod":"d"},"dt_txt":"2018-03-18 12:00:00"},{"dt":1521385200,"main":{"temp":0.92,"temp_min":0.92,"temp_max":0.92,"pressure":1026.59,"sea_level":1034.51,"grnd_level":1026.59,"humidity":58,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":68},"wind":{"speed":9.23,"deg":60.5046},"rain":{},"snow":{},"sys":{"pod":"d"},"dt_txt":"2018-03-18 15:00:00"},{"dt":1521396000,"main":{"temp":0.16,"temp_min":0.16,"temp_max":0.16,"pressure":1027.83,"sea_level":1035.73,"grnd_level":1027.83,"humidity":59,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":88},"wind":{"speed":8.02,"deg":59.0026},"rain":{},"snow":{},"sys":{"pod":"d"},"dt_txt":"2018-03-18 18:00:00"},{"dt":1521406800,"main":{"temp":0.3,"temp_min":0.3,"temp_max":0.3,"pressure":1029.49,"sea_level":1037.51,"grnd_level":1029.49,"humidity":61,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":80},"wind":{"speed":6.91,"deg":60.003},"rain":{},"snow":{},"sys":{"pod":"n"},"dt_txt":"2018-03-18 21:00:00"},{"dt":1521417600,"main":{"temp":0.36,"temp_min":0.36,"temp_max":0.36,"pressure":1030.57,"sea_level":1038.54,"grnd_level":1030.57,"humidity":63,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":76},"wind":{"speed":6.02,"deg":65.0003},"rain":{},"snow":{},"sys":{"pod":"n"},"dt_txt":"2018-03-19 00:00:00"},{"dt":1521428400,"main":{"temp":-0.83,"temp_min":-0.83,"temp_max":-0.83,"pressure":1030.97,"sea_level":1038.96,"grnd_level":1030.97,"humidity":66,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":4.97,"deg":60.502},"rain":{},"snow":{},"sys":{"pod":"n"},"dt_txt":"2018-03-19 03:00:00"},{"dt":1521439200,"main":{"temp":-1.59,"temp_min":-1.59,"temp_max":-1.59,"pressure":1031.56,"sea_level":1039.61,"grnd_level":1031.56,"humidity":67,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":4.06,"deg":53.0026},"rain":{},"snow":{},"sys":{"pod":"n"},"dt_txt":"2018-03-19 06:00:00"},{"dt":1521450000,"main":{"temp":1.91,"temp_min":1.91,"temp_max":1.91,"pressure":1032.91,"sea_level":1040.9,"grnd_level":1032.91,"humidity":71,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01d"}],"clouds":{"all":0},"wind":{"speed":3.71,"deg":51.0016},"rain":{},"snow":{},"sys":{"pod":"d"},"dt_txt":"2018-03-19 09:00:00"},{"dt":1521460800,"main":{"temp":5.12,"temp_min":5.12,"temp_max":5.12,"pressure":1033.7,"sea_level":1041.56,"grnd_level":1033.7,"humidity":68,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"02d"}],"clouds":{"all":8},"wind":{"speed":3.96,"deg":66.004},"rain":{},"snow":{},"sys":{"pod":"d"},"dt_txt":"2018-03-19 12:00:00"},{"dt":1521471600,"main":{"temp":5.71,"temp_min":5.71,"temp_max":5.71,"pressure":1033.5,"sea_level":1041.45,"grnd_level":1033.5,"humidity":63,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":32},"wind":{"speed":3.42,"deg":57.0014},"rain":{},"snow":{},"sys":{"pod":"d"},"dt_txt":"2018-03-19 15:00:00"},{"dt":1521482400,"main":{"temp":3.23,"temp_min":3.23,"temp_max":3.23,"pressure":1034.03,"sea_level":1041.96,"grnd_level":1034.03,"humidity":62,"temp_kf":0},"weather":[{"id":500,"main":"Rain","description":"light rain","icon":"10d"}],"clouds":{"all":0},"wind":{"speed":2.31,"deg":48.5013},"rain":{"3h":0.0099999999999998},"snow":{},"sys":{"pod":"d"},"dt_txt":"2018-03-19 18:00:00"},{"dt":1521493200,"main":{"temp":-0.74,"temp_min":-0.74,"temp_max":-0.74,"pressure":1035.48,"sea_level":1043.5,"grnd_level":1035.48,"humidity":89,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":68},"wind":{"speed":1.32,"deg":55.0005},"rain":{},"snow":{},"sys":{"pod":"n"},"dt_txt":"2018-03-19 21:00:00"}],"city":{"id":2643743,"name":"London","coord":{"lat":51.5085,"lon":-0.1258},"country":"GB","population":1000000}},
  callPassed = true;

  // Initialize the controller and a mock scope
  beforeEach(inject(function ($controller) {
    spyOn(_RestCallFactoryMock_, 'get').and.callFake(function (){
      return {
        then: function (successCallBack, errorCallBack) {
          if(callPassed) {
            successCallBack(mockedResult);
            return;
          }
          errorCallBack('Call Failed');
        }
      };
    });
    MainCtrl = $controller('MainCtrl', {RestCallFactory: _RestCallFactoryMock_});
    }));

  it('should initialize selected day index', function () {
    expect(_RestCallFactoryMock_.get).toHaveBeenCalledWith('data/2.5/forecast', {
      appid: 'cf17d36364a790526fade8fb83873eaf',
      units: 'metric',
      q: 'London,uk',
      mode:'json'
    });
  });

  it('should initialize selected day index', function () {
    expect(MainCtrl.selectedDayIndex).toBe(0);
  });

  it('should call Open Web API', function () {
    callPassed = false;
    setTimeout(function () {
      expect(_RestCallFactoryMock_.get).toHaveBeenCalled();
      expect(MainCtrl.dailyWeather.length).toBe(6);
    }, 500);
  });

  it('should call Open Web API and do nothing if call has failed', function () {
    callPassed = true;
    setTimeout(function () {
      expect(_RestCallFactoryMock_.get).toHaveBeenCalled();
      expect(MainCtrl.dailyWeather).toBe([]);
    }, 500);
  });

  it('should open up weather card of selected index', function () {
    MainCtrl.selectUserIndex(3);
    expect(MainCtrl.selectedDayIndex).toBe(3);
  });

});
